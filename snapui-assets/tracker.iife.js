var D=Object.defineProperty,U=Object.defineProperties;var k=Object.getOwnPropertyDescriptors;var y=Object.getOwnPropertySymbols;var x=Object.prototype.hasOwnProperty,R=Object.prototype.propertyIsEnumerable;var S=(l,c,i)=>c in l?D(l,c,{enumerable:!0,configurable:!0,writable:!0,value:i}):l[c]=i,A=(l,c)=>{for(var i in c||(c={}))x.call(c,i)&&S(l,i,c[i]);if(y)for(var i of y(c))R.call(c,i)&&S(l,i,c[i]);return l},E=(l,c)=>U(l,k(c));var d=(l,c,i)=>new Promise((o,u)=>{var g=s=>{try{p(i.next(s))}catch(h){u(h)}},m=s=>{try{p(i.throw(s))}catch(h){u(h)}},p=s=>s.done?o(s.value):Promise.resolve(s.value).then(g,m);p((i=i.apply(l,c)).next())});(function(){"use strict";let l;const c=new Uint8Array(16);function i(){if(!l&&(l=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!l))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return l(c)}const o=[];for(let t=0;t<256;++t)o.push((t+256).toString(16).slice(1));function u(t,e=0){return o[t[e+0]]+o[t[e+1]]+o[t[e+2]]+o[t[e+3]]+"-"+o[t[e+4]]+o[t[e+5]]+"-"+o[t[e+6]]+o[t[e+7]]+"-"+o[t[e+8]]+o[t[e+9]]+"-"+o[t[e+10]]+o[t[e+11]]+o[t[e+12]]+o[t[e+13]]+o[t[e+14]]+o[t[e+15]]}const m={randomUUID:typeof crypto!="undefined"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function p(t,e,n){if(m.randomUUID&&!e&&!t)return m.randomUUID();t=t||{};const a=t.random||(t.rng||i)();if(a[6]=a[6]&15|64,a[8]=a[8]&63|128,e){n=n||0;for(let r=0;r<16;++r)e[n+r]=a[r];return e}return u(a)}const s={getItem(t){let e=JSON.parse(window.localStorage.getItem(t));return e?e.expireTime<=Date.now()?(window.localStorage.removeItem(t),null):e.data:null},setItem(t,e,n=30*60*60*1e3){let a={data:e};n&&(a.expireTime=Date.now()+n),window.localStorage.setItem(t,JSON.stringify(a))},removeItem(t){window.localStorage.removeItem(t)},clear(){window.localStorage.clear()}},h=t=>new Promise((e,n)=>{const a=document.createElement("script");a.src=t,a.async=!0,a.onload=e,a.onerror=r=>n(new Error(`Failed to load: ${t}`,{cause:r})),document.head.appendChild(a)}),v=864e5,_="liveIntentData",T={appId:null,apolloAnonId:null,liveIntentData:{},onLoad:function(e){return d(this,arguments,function*({appId:t}){this.appId=t,this.host="https://aplo-evnt.com/api/v1/intent_pixel/track_request",this.canTrackUrl="https://aplo-evnt.com/api/v1/intent_pixel/can_track_visitor",this.apolloAnonId=localStorage.getItem("apolloAnonId"),this.apolloAnonId||(this.apolloAnonId=this.generateApolloAnonId(),localStorage.setItem("apolloAnonId",this.apolloAnonId)),this.canTrack=yield this.canTrackApiCall(),this.canTrack&&(yield this.loadAndGetLiveIntentData());let n=location.href;yield this.sendPageVisitEvent(window.location.href);let a=this;document.body.addEventListener("click",()=>{requestAnimationFrame(()=>{n!==location.href&&(n=location.href,a.sendPageVisitEvent(n))})},!0)})},sendPageVisitEvent:function(t){return d(this,null,function*(){const e={apollo_anon_id:this.apolloAnonId,event_type:"page_visit",page:t},n=JSON.parse(localStorage.getItem(`${this.appId}_eventQueue`))||[];n.push(e),localStorage.setItem(`${this.appId}_eventQueue`,JSON.stringify(n)),this.batchProcessEvents()})},batchProcessEvents:function(){return d(this,null,function*(){var r,w;const t=JSON.parse(localStorage.getItem(`${this.appId}_eventQueue`))||[],e=1,n=100;let a=[];for(;t.length>=e&&a.length<n;){const I=t.shift();a.push(E(A({},I),{email_md5:((r=this.liveIntentData)==null?void 0:r.email_md5)||null,email_sha2:((w=this.liveIntentData)==null?void 0:w.email_sha2)||null}))}if(a.length>0)try{yield this.sendEvents(a),localStorage.setItem(`${this.appId}_eventQueue`,JSON.stringify(t.slice(a.length)))}catch(I){console.log("ERROR",I)}})},sendEvents:function(t){return d(this,null,function*(){yield fetch(`${this.host}?app_id=${this.appId}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})})},canTrackApiCall:function(){return d(this,null,function*(){try{const t=s.getItem(`${this.appId}_canTrack`);if(t)return t;const n=yield(yield fetch(`${this.canTrackUrl}?x_app_id=${this.appId}`)).json();return s.setItem(`${this.appId}_canTrack`,n.can_track,v),n.can_track}catch(t){return console.log("ERROR",t),!1}})},loadAndGetLiveIntentData:function(){return d(this,null,function*(){var t;try{const e=s.getItem(_);if(e){this.liveIntentData=e;return}else yield h("https://d-code.liadm.com/did-0091.min.js"),(t=window.liQd_did_0091)!=null&&t.resolve&&window.liQd_did_0091.resolve(n=>{this.liveIntentData={email_md5:n.md5,email_sha2:n.sha2},s.setItem(_,this.liveIntentData,v)},n=>{console.error("LiveIntent resolve error:",n)},{qf:"0.1",resolve:["md5","sha2","nonId"]})}catch(e){console.log("ERROR",e)}})},generateApolloAnonId:function(){return p()}};window.trackingFunctions=T})();
