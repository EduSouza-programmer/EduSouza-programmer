!function(){var e=[,function(e,t){e.exports="//static.hsappstatic.net/HubspotToolsMenu/static-1.636/icons/sprocket_white.svg"},function(e,t){e.exports="//static.hsappstatic.net/HubspotToolsMenu/static-1.636/icons/sprocket_orange.svg"},function(e,t){e.exports="//static.hsappstatic.net/HubspotToolsMenu/static-1.636/icons/Edit.svg"},function(e,t){e.exports="//static.hsappstatic.net/HubspotToolsMenu/static-1.636/icons/ViewDetails.svg"},function(e,t){e.exports="//static.hsappstatic.net/HubspotToolsMenu/static-1.636/icons/SiteTree.svg"},function(e,t){e.exports="//static.hsappstatic.net/HubspotToolsMenu/static-1.636/icons/ExternalLink.svg"},function(e,t){e.exports="//static.hsappstatic.net/HubspotToolsMenu/static-1.636/icons/Gauge.svg"},function(e,t){e.exports="//static.hsappstatic.net/HubspotToolsMenu/static-1.636/icons/Code.svg"},function(e,t){e.exports="//static.hsappstatic.net/HubspotToolsMenu/static-1.636/icons/HtmlFile.svg"},function(e,t){e.exports="//static.hsappstatic.net/HubspotToolsMenu/static-1.636/icons/Warning.svg"},function(e,t){e.exports="//static.hsappstatic.net/HubspotToolsMenu/static-1.636/icons/Menu.svg"},function(e,t){e.exports="//static.hsappstatic.net/HubspotToolsMenu/static-1.636/icons/Desktop.svg"},function(e,t){e.exports="//static.hsappstatic.net/HubspotToolsMenu/static-1.636/icons/Hide.svg"},function(e,t){e.exports="//static.hsappstatic.net/HubspotToolsMenu/static-1.636/icons/Remove.svg"},function(e,t){e.exports="//static.hsappstatic.net/HubspotToolsMenu/static-1.636/css/toolsmenu.css"}],t={};function s(n){var o=t[n];if(void 0!==o)return o.exports;var i=t[n]={exports:{}};e[n].call(i.exports,i,i.exports,s);return i.exports}s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};s.d(t,{a:t});return t};s.d=function(e,t){for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})};s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};!function(){"use strict";const e="HS_SPROCKET_MENU_LOCAL_OVERRIDE",t="https://local.hsappstatic.net/HubspotToolsMenu/static-1.636/js/index.js",n=()=>Array.from(document.body.getElementsByTagName("script")).some((e=>e.src===t)),o=()=>!(!window.localStorage.getItem(e)&&1)&&!n(),i=()=>{const e=document.createElement("script");e.src=t;e.onload=()=>{setTimeout((()=>{const e=new Event("DOMContentLoaded");document.dispatchEvent(e)}),100)};document.body.appendChild(e)};o()&&i();var r=s(1),a=s.n(r),c=s(2),l=s.n(c),d=s(3),p=s.n(d),u=s(4),h=s.n(u),m=s(5),v=s.n(m),g=s(6),f=s.n(g),b=s(7),E=s.n(b),w=s(8),I=s.n(w),_=s(9),y=s.n(_),k=s(10),L=s.n(k),S=s(11),T=s.n(S),$=s(12),C=s.n($),A=s(13),U=s.n(A),D=s(14),x=s.n(D),H=s(15),M=s.n(H);const N={SUCCESS:"hs-local-dev-server--success",WARNING:"hs-local-dev-server--warning",FAILURE:"hs-local-dev-server--failed"},O=(e,t="hs-menu-icon")=>`<img class="${t}" src="${e}" alt="" aria-hidden="true" />`,P={edit:O(p()),viewDetails:O(h()),siteTree:O(v()),externalLink:O(f()),gauge:O(E()),code:O(I()),file:O(y()),warning:O(L()),menu:O(T()),desktop:O(C()),hide:O(U()),close:O(x(),"hs-remove-icon")};class G{constructor(e){this.baseUrl=this.getHsBaseUrl(e.app_hs_base_url);this.cpBaseUrl=this.getHsBaseUrl(e.cp_hs_base_url);this.contentId=e.dynamic_page_id&&"0"!==e.dynamic_page_id&&"null"!==e.dynamic_page_id?e.dynamic_page_id:e.page_id;this.categoryId=e.category_id;this.contentGroupId=e.content_group_id;this.portalId=e.portal_id;this.environments={PRODUCTION:1,STAGING:2};this.isCustomerPortal=!0===e.is_customer_portal;this.cmsEnvironment=this.getCmsEnvironmentFromCookie();this.contentUrl=this.getHsContentUrl();this.permissionObj={};this.dynamic_page_id=e.dynamic_page_id;e.scp_id&&"0"!==e.scp_id&&"null"!==e.scp_id&&(this.contentId=e.scp_id)}getHsBaseUrl(e){return window.localStorage.getItem("HS_LOCAL_TESTING")?e.replace(/[^/](\w+?)(?=\.)/,"local"):e}getHsContentUrl(){const e=window.location.href.split("?")[0],t=new URLSearchParams(window.location.search);return t.has("hs_preview")?`${e}?hs_preview=${t.get("hs_preview")}`:e}createElementFromHTML(e){const t=document.createElement("div");t.innerHTML=e.trim();return t.firstChild}jsonp(e,t){window.jsonpHandler=e=>{t(e)};const s=`${e}${-1!==e.indexOf("?")?"&":"?"}callback=jsonpHandler`,n=document.createElement("script");n.type="text/javascript";n.referrerPolicy="no-referrer-when-downgrade";n.async=!0;n.src=s;document.getElementsByTagName("head")[0].appendChild(n)}httpGet(e,t){const s=new XMLHttpRequest;s.withCredentials=!0;s.onreadystatechange=function(){4===this.readyState&&200===this.status&&t(JSON.parse(this.responseText))};s.open("GET",e,!0);s.send()}showToolsMenuIfAuthor(){let e,t=this.contentId;const s=this.contentUrl;let n=!1;if(this.isCustomerPortal)e="customer-portal";else if(window.location.pathname.endsWith("_hcms/mem/login"))e="content-membership";else if(20===this.categoryId)e="app-pages";else if(this.contentId&&this.contentGroupId)if(7===this.categoryId)e="blog-listing-pages";else if(6===this.categoryId)e="knowledge-articles";else if(12===this.categoryId)if(this.dynamic_page_id)e="knowledge-articles";else{e="knowledge-bases";t=this.contentGroupId}else e=13===this.categoryId?"case-studies":"blog-posts";else if(this.contentGroupId){e=6===this.categoryId?"knowledge-bases":"blogs";t=this.contentGroupId}else{n=!0;e="landing-pages"}const o=`${this.baseUrl}/content-tools-menu/api/v1/tools-menu/has-permission-json?portalId=${this.portalId}`;this.httpGet(o,(o=>{if(o.has_permission){const o=`${this.cpBaseUrl}/content-tools-menu/api/v1/tools-menu/permissions?portalId=${this.portalId}`;this.httpGet(o,(o=>{this.permissionObj=o;"content-membership"===e?this.getContentMembershipCookie(e,this.portalId):this.getAppLinks(e,t,this.portalId,s);n&&this.setupDeferredPrefetchingOfEditorAssets(e)}))}}))}getContentMembershipCookie(e,t){this.jsonp(`${this.baseUrl}/content-tools-menu/api/v1/content/validate-hubspot-user?redirect_url=${window.location.href}&portalId=${t}`,(e=>{if(e&&e.verified){const t=this.getUrlParameter("redirect_url")||e.redirectUrl||window.location.origin;window.location.href=`/_hcms/mem/automatic-login-loading-message?redirect_url=${t}`}}))}getAppLinks(e,t,s,n){"app-pages"!==e&&this.httpGet(`${this.baseUrl}/content-tools-menu/api/v1/tools-menu/${e}/${t}/actions-json?portalId=${s}&clientUrl=${n}`,(e=>{e.actions&&e.strings&&this.showAppLinks(e.actions,e.strings)}))}renderAction(e,t=""){const s=e[2]?`class='${e[2]}'`:"";return`<li><a target='_blank' ${e[1]?`href='${e[1]}'`:""} ${s}>\n${t}\n<span>${e[0]}</span>\n</a></li>`}getIconForAction(e){return!e.includes("Edit")||e.includes("Template")||e.includes("Navigation")?e.includes("View")&&e.includes("Details")?P.viewDetails:e.includes("Site Pages")||e.includes("Pages")?P.siteTree:e.includes("Redirect")||e.includes("URL")?P.externalLink:e.includes("Speed")||e.includes("Track")?P.gauge:e.includes("Developer")?P.code:e.includes("Template")||e.includes("File")?P.file:e.includes("Alert")||e.includes("Warning")?P.warning:e.includes("Navigation")||e.includes("Menu")?P.siteTree:P.viewDetails:P.edit}showAppLinks(e,t){const s=[].slice.call(document.querySelectorAll("[data-menu-id]")).filter((e=>!!e.getAttribute("data-menu-id").trim())),n=s.length>0?s[0]:null;if(null!==n){const s=n.getAttribute("data-menu-id").trim();e.push([t.EDIT_NAVIGATION_MENU,`${this.baseUrl}/menus/${this.portalId}/edit/${s}`])}let o=e.map((e=>this.renderAction(e,this.getIconForAction(e[0])))).join("");if(this.permissionObj.permissions.includes("CAN_PREVIEW_ENVIRONMENTS")){o+=`        <li><a class="hs-environment-buffer-on">${P.viewDetails}<span>${t.VIEW_BUFFER}</span></a></li>        <li><a class="hs-environment-buffer-off">${P.viewDetails}<span>${t.VIEW_HARD}</span></a></li>      `;o+=`        <li><a class="hs-environment-staging">${P.viewDetails}<span>${t.VIEW_STAGING}</span></a></li>        <li><a class="hs-environment-production">${P.viewDetails}<span>${t.VIEW_PRODUCTION}</span></a></li>      `}const i=`<link rel="stylesheet" href="${M()}" />`,r=`\n      <div class="hs-tools-menu hs-collapsed" aria-label="HubSpot Tools Menu">\n        <button class="hs-sprocket-button" aria-expanded="false" aria-label="Toggle menu">\n          <img class="hs-sprocket-icon" alt="${t.MENU_ICON_ALT_TEXT}" src="${a()}" />\n        </button>\n        <div class="hs-dropdown" aria-hidden="true">\n          <div class="hs-tools-menu-header">\n            <img class="hs-sprocket-logo" src="${l()}" alt="" />\n            <span class="hs-menu-title">${t.MENU_TITLE}</span>\n          </div>\n          <hr class="hs-menu-divider" />\n          <ul class="hs-tools-actions">\n            ${o}\n          </ul>\n          <hr class="hs-menu-divider" />\n          <div class="hs-tools-menu-footer">\n            <button class="hs-menu-item-button hs-local-dev-server" type="button">\n              ${P.desktop}\n              <span>Local Dev Server</span>\n              <div class="hs-toggle-switch">\n                <div class="hs-toggle-track"></div>\n                <div class="hs-toggle-knob"></div>\n              </div>\n            </button>\n            <button class="hs-menu-item-button hs-menu-hider" type="button">\n              ${P.hide}\n              <span>${t.HIDE_THIS_MENU}</span>\n            </button>\n          </div>\n        </div>\n      </div>\n    `;document.body.appendChild(this.createElementFromHTML(i));document.body.appendChild(this.createElementFromHTML(r));this.registerEvents()}registerEvents(){const e=document.querySelector(".hs-tools-menu");this.registerDropdown(e);e.querySelector(".hs-menu-hider").addEventListener("click",(t=>{t.preventDefault();t.stopPropagation();e.style.display="none"}));const t=e.querySelector(".hs-local-dev-server");t&&t.addEventListener("click",(e=>{e.preventDefault();e.stopPropagation();this.setUpLocalDevUrl()}));const s=e.querySelector(".hs-environment-buffer-on");s&&(this.cmsEnvironment.buffer?s.parentElement.removeChild(s):s.addEventListener("click",(e=>{e.preventDefault();e.stopPropagation();this.requestAndSetEnvironmentCookie(this.portalId,!0,this.cmsEnvironment.environmentId)})));const n=e.querySelector(".hs-environment-buffer-off");n&&(this.cmsEnvironment.buffer?n.addEventListener("click",(e=>{e.preventDefault();e.stopPropagation();this.requestAndSetEnvironmentCookie(this.portalId,!1,this.cmsEnvironment.environmentId)})):n.parentElement.removeChild(n));const o=e.querySelector(".hs-environment-staging");o&&(this.cmsEnvironment.environmentId!==this.environments.STAGING?o.addEventListener("click",(e=>{e.preventDefault();e.stopPropagation();this.requestAndSetEnvironmentCookie(this.portalId,this.cmsEnvironment.buffer,this.environments.STAGING)})):o.parentElement.removeChild(o));const i=e.querySelector(".hs-environment-production");i&&(this.cmsEnvironment.environmentId!==this.environments.PRODUCTION?i.addEventListener("click",(e=>{e.preventDefault();e.stopPropagation();this.requestAndSetEnvironmentCookie(this.portalId,this.cmsEnvironment.buffer,this.environments.PRODUCTION)})):i.parentElement.removeChild(i))}requestAndSetEnvironmentCookie(e,t,s){const n=`${this.cpBaseUrl}/content-tools-menu/api/v1/tools-menu/environment-cookie?portalId=${e}&environmentId=${s}&buffer=${t}`;this.httpGet(n,(e=>{document.cookie=`hs_cms_environment=${btoa(JSON.stringify(e))}`;window.location.reload()}))}registerDropdown(e){const t=e.querySelector(".hs-sprocket-button"),s=e.querySelector(".hs-dropdown"),n=()=>{e.classList.add("hs-collapsed");t.setAttribute("aria-expanded","false");s.setAttribute("aria-hidden","true");const n=t.querySelector("img");if(n){n.src=a();n.className="hs-sprocket-icon";n.alt="Toggle menu"}},o=()=>{e.classList.remove("hs-collapsed");t.setAttribute("aria-expanded","true");s.setAttribute("aria-hidden","false");const n=t.querySelector("img");if(n){n.src=x();n.className="hs-remove-icon";n.alt=""}s.style.display=""},i=()=>{n();document.body.removeEventListener("click",i)},r=t=>{t.preventDefault();t.stopPropagation();if(e.classList.contains("hs-collapsed")){o();document.body.addEventListener("click",i)}else{n();document.body.removeEventListener("click",i)}};t.addEventListener("click",r,!1);s.addEventListener("click",(e=>{e.target.closest("a[href]")||e.stopPropagation()}))}getUrlParameter(e){e=e.replace(/[[]/,"\\[").replace(/[\]]/,"\\]");const t=new RegExp(`[\\?&]${e}=([^&#]*)`).exec(location.search);return null===t?"":decodeURIComponent(t[1].replace(/\+/g," "))}getCmsEnvironmentFromCookie(){const e=this.getCookie("hs_cms_environment");return e?JSON.parse(atob(e)):{portalId:0,environmentId:this.environments.PRODUCTION,buffer:!1,createdAt:0}}getCookie(e){const t=`${e}=`,s=document.cookie.split(";");for(let e=0;e<s.length;e++){let n=s[e];for(;" "===n.charAt(0);)n=n.substring(1);if(0===n.indexOf(t))return n.substring(t.length,n.length)}return""}setupDeferredPrefetchingOfEditorAssets(e){window.addEventListener("load",(()=>{setTimeout((()=>{let t;if("landing-pages"!==e)return;t="content/editor/prefetcher.js";const s=document.createElement("script");s.src=`${this.baseUrl}/${t}`;document.head.appendChild(s)}),2e3)}))}setUpLocalDevUrl(){let e=window.location.hostname,t=window.location.pathname;const s=window.location.search,n=document.querySelector(".hs-tools-menu .hs-local-dev-server");s&&s.slice("1").split("&").forEach((s=>{if(s.indexOf("hsDebugOverridePublicHost")>-1){e=s.split("=")[1];t=t.replace("/cos-rendering/v1/public","")}}));const o={hostName:e,pathName:t,protocol:window.location.protocol,contentId:this.contentId,portalId:this.portalId},i=Object.keys(o).map((e=>`${e}=${o[e]}`)).join("&"),r=this.resetLocalDevLink.bind(this),a=this.setLocalDevServerSuccess.bind(this),c=this.setLocalDevServerFailure.bind(this);r(n);fetch(`http://localhost:1442/check-if-local-dev-server?${i}`).then((e=>{if(!e.ok)throw e.statusText;return e.json()})).then((e=>a(e,n))).catch((e=>{console.error(e);c(n)}))}resetLocalDevLink(e){e.classList.remove(N.SUCCESS,N.WARNING,N.FAILURE);e.removeAttribute("title")}setLocalDevServerSuccess(e,t){if(e.localProxyUrl){t.classList.add(N.SUCCESS);window.open(e.localProxyUrl,"_blank")}else{t.classList.add(N.WARNING);t.setAttribute("title","Proxy unavailable - Click to retry")}}setLocalDevServerFailure(e){e.classList.add(N.FAILURE);e.setAttribute("title","Local server not running - Click to retry")}}class R{constructor(){this.getShowAllFiltersLinkEventHandler=e=>t=>{const{previousElementSibling:{children:s}}=e;s&&[].slice.call(s,0).forEach((e=>{e.style.display="block"}));e.style.display="none";t.preventDefault();t.stopPropagation()}}setup(){[].slice.call(document.querySelectorAll(".filter-expand-link"),0).forEach((e=>{e.addEventListener("click",this.getShowAllFiltersLinkEventHandler(e))}))}}const q=()=>{const e=window.location,{port:t,hostname:s,pathname:n}=e,i=e!==window.parent.location,r=n.includes("_hcms/preview/template"),a=""!==t||s.includes("hslocal.net")||s.includes("localhost");return!(i||r||o()||a)};!function(){if(window.document.documentMode)return;const e=()=>{if(!window.hsVars||!window.hsVars.portal_id)return;new G(window.hsVars).showToolsMenuIfAuthor();(new R).setup()};q()&&("loading"===document.readyState?document.addEventListener("DOMContentLoaded",(function t(){e();document.removeEventListener("DOMContentLoaded",t)}),!1):e())}()}()}();
//# sourceMappingURL=//static.hsappstatic.net/HubspotToolsMenu/static-1.636/js/index.js.map